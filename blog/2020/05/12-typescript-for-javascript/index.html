<!doctype html>
<html lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="mobile-web-app-capable" content="yes" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="author" content="Wolfram Kriesing">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="picostitch - stitching knowhow for the world, bit by bit">
  <link rel="stylesheet" href="/style.css" type="text/css">
  <script async defer data-domain="picostitch.com" src="https://plausible.io/js/plausible.js"></script>
  <link rel="canonical" href="https://picostitch.com/blog/2020/05/12-typescript-for-javascript/">
  <title>TypeScript for JavaScript, Part 1 - Getting Started | picostitch - crafting (and) JavaScript</title>
  
</head>
<body class="page-post">

  <header>
    <nav class="primary">
      <ul>
        
          <li><a href="/">Home üè†</a></li>
        
          <li><a href="/tidbits">Tidbits üòã</a></li>
        
          <li><a href="/about">About üí°</a></li>
        
      </ul>
    </nav>

    <div class="sitename">
      <a href="/">picostitch</a>
      <div class="subtitle">
        crafting (and) JavaScript
      </div>
    </div>
  </header>

  <nav class="breadcrumb">
    
  <a href="/">Home</a> &raquo;
  Blog &raquo;
  <a href="/blog/2020/05/">May 2020</a> &raquo;
  TypeScript for JavaScript, Part 1 - Getting Started

  </nav>

  <main>
    <aside>
      <nav class="tags">
        <header>Top Blog Tags</header>
        <ol>
          
          <li><a href="/blog/tag/knowledgebase/">#knowledgebase</a></li>
          
          <li><a href="/blog/tag/javascript/">#javascript</a></li>
          
          <li><a href="/blog/tag/video/">#video</a></li>
          
          <li><a href="/blog/tag/testing/">#testing</a></li>
          
          <li><a href="/blog/tag/oop/">#oop</a></li>
          
          <li><a href="/blog/tag/refactoring/">#refactoring</a></li>
          
          <li><a href="/blog/tag/ruby/">#ruby</a></li>
          
          <li><a href="/blog/tag/functional/">#functional</a></li>
          
          <li><a href="/blog/tag/links/">#links</a></li>
          
          <li><a href="/blog/tag/learning/">#learning</a></li>
          
        </ol>
      </nav>

      <nav class="months">
        <header>Posts by Month</header>
        <ol>
          
          <li><a href="/blog/2020/05/">May 2020</a></li>
          
          <li><a href="/blog/2020/04/">April 2020</a></li>
          
          <li><a href="/blog/2020/03/">March 2020</a></li>
          
          <li><a href="/blog/2018/07/">July 2018</a></li>
          
          <li><a href="/blog/2018/05/">May 2018</a></li>
          
          <li><a href="/blog/2017/11/">November 2017</a></li>
          
          <li><a href="/blog/2017/04/">April 2017</a></li>
          
          <li><a href="/blog/2017/03/">March 2017</a></li>
          
          <li><a href="/blog/2017/02/">February 2017</a></li>
          
          <li><a href="/blog/2017/01/">January 2017</a></li>
          
          <li><a href="/blog/2016/06/">June 2016</a></li>
          
          <li><a href="/blog/2016/04/">April 2016</a></li>
          
          <li><a href="/blog/2016/02/">February 2016</a></li>
          
          <li><a href="/blog/2015/12/">December 2015</a></li>
          
          <li><a href="/blog/2015/11/">November 2015</a></li>
          
          <li><a href="/blog/2015/10/">October 2015</a></li>
          
          <li><a href="/blog/2015/05/">May 2015</a></li>
          
          <li><a href="/blog/2015/04/">April 2015</a></li>
          
          <li><a href="/blog/2015/03/">March 2015</a></li>
          
          <li><a href="/blog/2014/03/">March 2014</a></li>
          
          <li><a href="/blog/2014/02/">February 2014</a></li>
          
          <li><a href="/blog/2014/01/">January 2014</a></li>
          
        </ol>
      </nav>
    </aside>
    <div class="content">
      
  <article class="isDraft">
    <header>
      <h1>
        TypeScript for JavaScript, Part 1 - Getting Started
         [this is a draft]
      </h1>
      <div class="metadata">
        Wolfram Kriesing
        - May 12, 2020
        
          - tagged with: #javascript #typescript #typing #setup #ts4js
        
      </div>
    </header>

    <p>You don&#39;t need to rename all your &quot;.js&quot; files to &quot;.ts&quot; to go all in on TypeScript, you can go gradually. 
Adopt TypeScript step by step, become familiar with it in your existing JavaScript project.
No need to put development on hold for weeks, while you convert the code base to TypeScript and fix all type errors.
Read on to see how I adopt TypeScript for JavaScript for the project <a href="https://jskatas.org">jskatas.org</a> sourcecode.</p>
<p>Let&#39;s type check JavaScript files by using TypeScript.</p>
<h2 id="official-docs-are-scarce-on-this-topic">Official Docs are Scarce on this Topic</h2>
<p>The TypeScript docs have one page on the topic 
<a href="https://www.typescriptlang.org/docs/handbook/type-checking-javascript-files.html">Type Checking JavaScript Files</a>.
But there is a bit more to it. Thanks to <a href="https://twitter.com/JanMiksovsky">Jan</a> and his project <a href="https://twitter.com/ElixElements/">elix</a>
<a href="https://github.com/elix/elix/pull/109#issuecomment-575589440">I learned</a> the basics and how to apply TypeScript as a type linter on JS files.  </p>
<h2 id="what-is-typescript-for-javascript">What is TypeScript for JavaScript?</h2>
<p><a href="https://gitlab.com/wolframkriesing/talk-flow-type-enterjs-2017">I used to do a lot of</a> <a href="https://flow.org/">Flow</a> to type check my JavaScript code. Meanwhile TypeScript is picking up in features,
though there are major differences in philosophy between Flow and TypeScript.
But TypeScript seems to be the more active project and the one getting more support,
from the community (the <a href="https://github.com/facebook/flow/graphs/commit-activity">activity on</a> <a href="https://github.com/microsoft/TypeScript/graphs/commit-activity">the projects</a> seems to be on par though). 
Therefore TypeScript currently seems like a very interesting option.</p>
<p>So I started to investigate how I can use TypeScript on existing JavaScript projects.
Why not pure TypeScript? The main reason for me was always development speed and a small dependency footprint. 
One way to achieve this is that I try to prevent all build steps and want to run my code straight without 
building and bundling, no matter if I run a browser or nodejs project. 
So depending on the TypeScript compiler to compile my files before I can run them was not an option for me.</p>
<p>In the following you can see how I <strong>set up TypeScript, as a type linter for JavaScript</strong>, 
to type check JavaScript files.</p>
<h2 id="why-typescript-for-javascript">Why TypeScript for JavaScript?</h2>
<p>This allows me to type-lint my code optionally. If (for whatever reason) I don&#39;t want type safety, I don&#39;t have
to worry about it. With pure TypeScript (.ts files) it is not so easy to opt out (afaik) and .ts files are not useable 
in the browser without preprocessing.</p>
<p>Why should I do it at all, when it is optional?
Any linter is optional too. Discipline and interest are required.
Here are a couple of reasons why I think it is valueable:</p>
<ul>
<li>When data structures get complex, types help a lot and I want a tool to point out mistakes.</li>
<li>When the domain language forms, I want to name things coherently across the project, types are very useful.</li>
<li>When the team grows, types are more expressive and help staying aligned.</li>
<li><a href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#exhaustiveness-checking">Exhaustivness checks</a> create safety and prevent bugs.</li>
<li>Type checking makes me think about the architecture more, even if I type the code afterwards.</li>
</ul>
<h2 id="how-to-start-with-typescript-for-a-javascript-project">How to start with TypeScript for a JavaScript Project</h2>
<p>When I started applying TypeScript to JavaScript files I had a couple simple rules:</p>
<ol>
<li><strong>JavaScript files stay JavaScript</strong>. Prevent bloat of types mangled into JavaScript syntax.
JavaScript can be hard to read already without types in it.</li>
<li><strong>I want to be able to stop and go back any time</strong> - I didn&#39;t want to get stuck with a half baked solution 
that stops any development on the code.</li>
<li><strong>No extra compile/transpile step</strong>, no transpiler, no bundling needed.</li>
<li>I want to <strong>add type checks where needed</strong>. If all files get type checked eventually, 
cool, but that&#39;s not a must.</li>
</ol>
<p>Types can be added via comments. For example a function can be annotated with types like this:</p>
<pre><code class="language-javascript">/**
 * @param data {PlainObject}
 * @return {string}
 */
const renderTidbitPage = (data) =&gt; {}</code></pre>
<p>Where <code>PlainObject</code> is a custom type.
TypeScript will pick up these type definition and understand them.
All JavaScript code will stay Javascript code.</p>
<p>Let&#39;s start adding and configuring TypeScript to jskatas.org code base.
It should be very easy to adapt this to any project at any moment.</p>
<h2 id="install-typescript-dependency">Install TypeScript Dependency</h2>
<p>Start with <code>npm i typescript --save-dev</code>. We don&#39;t need typescript during production,
so at it only to the devDependencies using <code>--save-dev</code> or <code>-D</code>.</p>
<figure style="display: inline-block">
    <img src="./install-typescript.gif" alt="diff in package.json of installed typescript" width="70%"/>
    <figcaption>The diff in the package.json of installed typescript</figcaption>
</figure>

<p>This is <a href="https://github.com/wolframkriesing/jskatas.org/commit/d5c714565526cc88feb6612fa0f7b49aae5d1b2d">the commit on jskatas.org repo</a>.</p>
<p>Running <code>tsc</code> (the executable for typescript) now does nothing useful with our source code yet,
it just lists all its options.</p>
<pre><code>&gt; ./node_modules/.bin/tsc
Version 3.8.3
Syntax:   tsc [options] [file...]

Examples: tsc hello.ts
          tsc --outFile file.js file.ts
          tsc @args.txt
          tsc --build tsconfig.json

Options:
 -h, --help                                         Print this message.
 -w, --watch                                        Watch input files.
 --pretty                                           Stylize errors and messages u
...</code></pre><h2 id="add-npm-script-for-type-checking">Add Npm Script for Type Checking</h2>
<p>I added a npm script <code>npm run typecheck</code> which is just an alias for <code>tsc</code>
(<a href="https://github.com/wolframkriesing/jskatas.org/commit/11d1fde4673b9204792212fa7d2c98160ad92dcf">see the commit</a>).
Additionally <code>npm run dev:typecheck</code> runs tsc in watch mode (I prefer to prefix my dev scripts with <code>dev:</code>).</p>
<figure style="display: inline-block">
    <img src="./add-typecheck-script.gif" alt="" width="70%"/>
    <figcaption></figcaption>
</figure>

<p>Still nothing happens yet in regards to type checking, tsc is just not yet configured.
Let&#39;s configure tsc.</p>
<h2 id="add-typescript-confguration-in-tsconfigjson">Add TypeScript Confguration in tsconfig.json</h2>
<p>TypeScript&#39;s configuration goes into a file <code>tsconfig.json</code> normally in the root of the project
(<a href="https://github.com/wolframkriesing/jskatas.org/commit/2a9bbcd7182295c7074bb1662e915a4af00df71b">commit</a>).</p>
<figure style="display: inline-block">
    <img src="./empty-tsconfig.gif" alt="" width="300"/>
    <figcaption></figcaption>
</figure>

<p>I just added an empty <code>tsconfig.json</code>. Which gets us a step futher. I am just a fan of baby steps,
this way I learn bit by bit the effect of every change. I prefer this over throwing a huge config in my
project which does a zillion things that I did not anticipated. They gonna swing back eventually.</p>
<p>Running the type check now gives us a hint what to do next.</p>
<pre><code>&gt; npm run typecheck

&gt; jskatas.org@2.0.0 typecheck /app
&gt; tsc

error TS18003: No inputs were found in config file &#39;/app/tsconfig.json&#39;. Specified &#39;include&#39; paths were &#39;[&quot;**/*&quot;]&#39; and &#39;exclude&#39; paths were &#39;[]&#39;.</code></pre><p>We will do exactly this next.</p>
<h2 id="add-include-to-tsconfigjson">Add &quot;include&quot; to tsconfig.json</h2>
<p>Let&#39;s start including all JS files from our <code>src</code> folder 
(<a href="https://github.com/wolframkriesing/jskatas.org/commit/527c05f5202fdf857c2902427a28de4857fe944c">commit</a>).</p>
<figure style="display: inline-block">
    <img src="./tsconfig-with-include.gif" alt="" width="500"/>
    <figcaption></figcaption>
</figure>

<pre><code>&gt; npm run typecheck

&gt; jskatas.org@2.0.0 typecheck /app
&gt; tsc

error TS18003: No inputs were found in config file &#39;/app/tsconfig.json&#39;. Specified &#39;include&#39; paths were &#39;[&quot;src/*.js&quot;]&#39; and &#39;exclude&#39; paths were &#39;[]&#39;.</code></pre><p>By default tsc looks for <code>.ts</code> files. But there are none here, there are
only <code>.js</code> files. That&#39;s why the error message did not change much.
Let&#39;s make sure tsc finds our files and starts type checking useful stuff.</p>
<h2 id="make-typescript-find-js-files---the-allowjs-option">Make TypeScript find JS Files - The &quot;allowJs&quot; Option</h2>
<p>TypeScript has quite a number of <a href="https://www.typescriptlang.org/docs/handbook/compiler-options.html">compilerOptions</a>
they can either be passed as command line arguments or set in the <code>tsconfig.json</code>, which is what we will do
(<a href="https://github.com/wolframkriesing/jskatas.org/commit/5b24fd2bd522291909fe534f320c74571748e8c4">commit</a>).
We add &quot;allowJs&quot; to &quot;compilerOptions&quot;. The <a href="https://www.typescriptlang.org/v2/en/tsconfig#allowJs">docs describe it</a> like this:</p>
<blockquote>
<p>Allow JavaScript files to be imported inside your project, instead of just .ts and .tsx files.</p>
</blockquote>
<figure style="display: inline-block">
    <img src="./tsconfig-allowjs.gif" alt="" width="500"/>
    <figcaption></figcaption>
</figure>

<pre><code>&gt; npm run typecheck

&gt; jskatas.org@2.0.0 typecheck /app
&gt; tsc

error TS5055: Cannot write file &#39;/app/src/config.js&#39; because it would overwrite input file.
error TS5055: Cannot write file &#39;/app/src/env.js&#39; because it would overwrite input file.
error TS5055: Cannot write file &#39;/app/src/kata.js&#39; because it would overwrite input file.

...

Found 9 errors.</code></pre><p>Oha. What does tsc want to do now? We have not passed the option <code>outDir</code> which determines the
directory where tsc would write the compiled files to. So it tries to write the files to the same
location where it found them. Fortunately it does not overwrite the existing file.
Even though, if it would it would still run as expected but the source code would be rewritten,
and it would be using a lot of <code>var</code> and node-style <code>export.*</code>, replace ES6 classes with <code>function</code> etc.
basically down-compile the code to ES3.
Using the <a href="https://www.typescriptlang.org/v2/en/tsconfig#target">config option <code>target</code></a>
one can control what the target version of ECMAScript shall be.</p>
<p>Actually we don&#39;t need no compiled files, so let&#39;s turn that off.</p>
<h2 id="no-compiled-files-needed---the-noemit-option">No Compiled Files Needed - The &quot;noEmit&quot; Option</h2>
<p>We are using TypeScript only to verify types, not to convert or compile our source files to 
anything else, so we add the <code>noEmit</code> option to turn off writing files
(<a href="https://github.com/wolframkriesing/jskatas.org/commit/65c0ab8c6cfe8c35e347e3a340d76faaf992b247">commit</a>).</p>
<figure style="display: inline-block">
    <img src="./tsconfig-noemit.gif" alt="" width="500"/>
    <figcaption></figcaption>
</figure>

<p>Running this:</p>
<pre><code>&gt; npm run typecheck

&gt; jskatas.org@2.0.0 typecheck /app
&gt; tsc</code></pre><p>There is no output. Thinking (and reading) about what TypeScript actually is and that it is 
sold that it <a href="https://www.typescriptlang.org/">&quot;compiles to plain JavaScript&quot;</a>, the expected input it a &quot;.ts&quot; file.
But we have none. That means, we have to configure it to also type check JavaScript file.
We will do that next using the &quot;checkJs&quot; option.</p>
<h2 id="report-type-errors-in-js-files---the-checkjs-option">Report Type Errors in JS Files - The &quot;checkJs&quot; Option</h2>
<p><a href="https://www.typescriptlang.org/v2/en/tsconfig#checkJs">The docs explain the &quot;checkJs&quot; option</a> quite well:</p>
<blockquote>
<p>Works in tandem with <code>allowJs</code>. When <code>checkJs</code> is enabled then errors are reported in JavaScript files. 
This is the equivalent of including <code>// @ts-check</code> at the top of all JavaScript files which are included in your project.</p>
</blockquote>
<p><a href="https://github.com/wolframkriesing/jskatas.org/commit/7afb09295f9f66d28510152d4dbb24bc26d726a8">https://github.com/wolframkriesing/jskatas.org/commit/7afb09295f9f66d28510152d4dbb24bc26d726a8</a></p>
<figure style="display: inline-block">
    <img src="./tsconfig-checkjs.gif" alt="" width="500"/>
    <figcaption></figcaption>
</figure>

<pre><code>&gt; npm run typecheck

&gt; jskatas.org@2.0.0 typecheck /app
&gt; tsc

src/config.js:28:10 - error TS2339: Property &#39;bundleName&#39; does not exist on type &#39;BundleConfig&#39;.

28     inst.bundleName = bundleName;
            ~~~~~~~~~~

src/config.js:29:10 - error TS2339: Property &#39;sourceUrl&#39; does not exist on type &#39;BundleConfig&#39;.

29     inst.sourceUrl = `${katasUrl}/${bundleName}/__all__.json`;
            ~~~~~~~~~

...

Found 24 errors.
</code></pre><h2 id="check-srcscripts-dir">Check src+scripts dir</h2>
<p><a href="https://github.com/wolframkriesing/jskatas.org/commit/374985ef6171733eaea7e85db202705770ad0b6a">https://github.com/wolframkriesing/jskatas.org/commit/374985ef6171733eaea7e85db202705770ad0b6a</a></p>
<figure style="display: inline-block">
    <img src="./tsconfig-include-all.gif" alt="" width="500"/>
    <figcaption></figcaption>
</figure>

<pre><code>&gt; npm run typecheck

&gt; jskatas.org@2.0.0 typecheck /app
&gt; tsc

...

Found 72 errors.</code></pre>

    
    
  </article>

    </div>
    <aside class="right">
      
  

    </aside>
  </main>

  <footer>
    <div>
      <b>Pages</b><br/>
      <ul>
        
          <li><a href="/">Home üè†</a></li>
        
          <li><a href="/tidbits">Tidbits üòã</a></li>
        
          <li><a href="/about">About üí°</a></li>
        
      </ul>
    </div>
    <div>
      <b>Contact</b><br/>
      <ul>
        <li><a href="https://twitter.com/wolframkriesing">Twitter</a><br/></li>
        <li><a href="mailto:w+through-picostitch-footer-contact@kriesing.de">Email</a><br/></li>
      </ul>
    </div>
    <div></div>
  </footer>

  <nav class="secondary">
    <ul>
      
        <li><a href="/">Home üè†</a></li>
      
        <li><a href="/tidbits">Tidbits üòã</a></li>
      
        <li><a href="/about">About üí°</a></li>
      
    </ul>
  </nav>

</body>
</html>